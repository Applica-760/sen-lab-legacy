# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€`esn-lab`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã¨å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã«ã¤ã„ã¦èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“ è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆ

```
configs/
â”œâ”€â”€ base.yaml              # åŸºæœ¬è¨­å®šï¼ˆå…¨ãƒ¢ãƒ¼ãƒ‰ã§å…±é€šï¼‰
â”œâ”€â”€ train/
â”‚   â”œâ”€â”€ single.yaml       # å˜ä¸€ãƒ‡ãƒ¼ã‚¿è¨“ç·´
â”‚   â”œâ”€â”€ batch.yaml        # ãƒãƒƒãƒè¨“ç·´
â”‚   â””â”€â”€ tenfold.yaml      # 10-foldäº¤å·®æ¤œè¨¼
â”œâ”€â”€ predict/
â”‚   â”œâ”€â”€ single.yaml       # å˜ä¸€ãƒ‡ãƒ¼ã‚¿æ¨è«–
â”‚   â””â”€â”€ batch.yaml        # ãƒãƒƒãƒæ¨è«–
â”œâ”€â”€ evaluate/
â”‚   â”œâ”€â”€ run.yaml          # å®Ÿè¡Œçµæœè©•ä¾¡
â”‚   â”œâ”€â”€ summary.yaml      # é›†ç´„çµæœè©•ä¾¡
â”‚   â””â”€â”€ tenfold.yaml      # 10-foldè©•ä¾¡
â””â”€â”€ integ/                # çµ±åˆå®Ÿé¨“ç”¨
```

## ğŸ”§ base.yaml - åŸºæœ¬è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§å…±é€šã™ã‚‹è¨­å®šã‚’å®šç¾©ã—ã¾ã™ã€‚

```yaml
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå
project: "esn-research"

# ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ¼ãƒ‰ï¼ˆå†ç¾æ€§ã®ãŸã‚ï¼‰
seeds: [2024, 706, 4410, 5385, 1029, 1219, 8380, 8931, 5963, 19800]

# ã‚¯ãƒ©ã‚¹æ•°
num_of_classes: 3

# ãƒ‡ãƒ¼ã‚¿è¨­å®š
data:
    type: "complement"  # ãƒ‡ãƒ¼ã‚¿ã®ç¨®é¡

# ãƒ¢ãƒ‡ãƒ«è¨­å®š
model:
    name: "esn"         # ãƒ¢ãƒ‡ãƒ«å
    Nu: 256            # å…¥åŠ›æ¬¡å…ƒ
    Nx: 100            # ãƒªã‚¶ãƒãƒ¼æ¬¡å…ƒ
    Ny: 3              # å‡ºåŠ›æ¬¡å…ƒ
    density: 0.5       # ãƒªã‚¶ãƒãƒ¼çµåˆå¯†åº¦
    input_scale: 0.01  # å…¥åŠ›ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
    rho: 0.9           # ã‚¹ãƒšã‚¯ãƒˆãƒ«åŠå¾„
    optimizer: "tikhonov"  # æœ€é©åŒ–æ‰‹æ³•
```

### ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿èª¬æ˜

#### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `project` | str | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåï¼ˆãƒ­ã‚°ã‚„ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®è­˜åˆ¥ã«ä½¿ç”¨ï¼‰ |
| `seeds` | list[int] | ãƒ©ãƒ³ãƒ€ãƒ ã‚·ãƒ¼ãƒ‰ã®ãƒªã‚¹ãƒˆï¼ˆ10-foldç”¨ã«10å€‹æ¨å¥¨ï¼‰ |
| `num_of_classes` | int | åˆ†é¡ã‚¯ãƒ©ã‚¹æ•° |

#### ãƒ‡ãƒ¼ã‚¿è¨­å®š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `data.type` | str | ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ç¨®é¡ï¼ˆ"complement"ç­‰ï¼‰ |

#### ãƒ¢ãƒ‡ãƒ«è¨­å®š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `model.name` | str | ãƒ¢ãƒ‡ãƒ«åï¼ˆç¾åœ¨ã¯"esn"ã®ã¿ã‚µãƒãƒ¼ãƒˆï¼‰ |
| `model.Nu` | int | å…¥åŠ›æ¬¡å…ƒï¼ˆç‰¹å¾´é‡ã®æ¬¡å…ƒæ•°ï¼‰ |
| `model.Nx` | int | ãƒªã‚¶ãƒãƒ¼ãƒ‹ãƒ¥ãƒ¼ãƒ­ãƒ³æ•°ï¼ˆ100ã€œ1000æ¨å¥¨ï¼‰ |
| `model.Ny` | int | å‡ºåŠ›æ¬¡å…ƒï¼ˆé€šå¸¸ã¯ã‚¯ãƒ©ã‚¹æ•°ã¨åŒã˜ï¼‰ |
| `model.density` | float | ãƒªã‚¶ãƒãƒ¼ã®çµåˆå¯†åº¦ï¼ˆ0.0ã€œ1.0ã€0.5æ¨å¥¨ï¼‰ |
| `model.input_scale` | float | å…¥åŠ›ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ä¿‚æ•°ï¼ˆ0.001ã€œ1.0ï¼‰ |
| `model.rho` | float | ã‚¹ãƒšã‚¯ãƒˆãƒ«åŠå¾„ï¼ˆ0.0ã€œ1.5ã€0.9æ¨å¥¨ï¼‰ |
| `model.optimizer` | str | æœ€é©åŒ–æ‰‹æ³•ï¼ˆ"tikhonov" or "pseudo_inverse"ï¼‰ |

## ğŸ“ train/ - è¨“ç·´è¨­å®š

### train/single.yaml - å˜ä¸€ãƒ‡ãƒ¼ã‚¿è¨“ç·´

```yaml
# ãƒ‡ãƒ¼ã‚¿æŒ‡å®š
id: "sample_001"                        # ã‚µãƒ³ãƒ—ãƒ«ID
path: "/path/to/data/sample_001.jpg"   # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
class_id: 0                             # ã‚¯ãƒ©ã‚¹ãƒ©ãƒ™ãƒ«
```

### train/batch.yaml - ãƒãƒƒãƒè¨“ç·´

```yaml
# CSVãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ï¼ˆid, path, class_idã®åˆ—ã‚’å«ã‚€ï¼‰
csv_path: "/path/to/train_data.csv"
```

**CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:**
```csv
id,path,class_id
sample_001,/path/to/sample_001.jpg,0
sample_002,/path/to/sample_002.jpg,1
sample_003,/path/to/sample_003.jpg,2
```

### train/tenfold.yaml - 10-foldäº¤å·®æ¤œè¨¼

```yaml
# ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š
data_source:
  type: "npy"                      # "npy" or "csv"
  npy_dir: "dataset/10fold_npy/"   # NPYå½¢å¼ã®å ´åˆ
  # csv_dir: "dataset/10fold_csvs/" # CSVå½¢å¼ã®å ´åˆ

# å®Ÿé¨“è¨­å®š
experiment_name: "tenfold_experiment"  # å®Ÿé¨“å
workers: 10                            # ä¸¦åˆ—ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°

# ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
hyperparams:
  Nx: [100, 200, 500]              # è¤‡æ•°æŒ‡å®šã§è‡ªå‹•ã‚°ãƒªãƒƒãƒ‰ã‚µãƒ¼ãƒ
  input_scale: [0.001, 0.005, 0.01]
  rho: [0.9]
```

#### ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹è¨­å®š

| ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | å‹ | èª¬æ˜ |
|-----------|-----|------|
| `data_source.type` | str | "npy"ï¼ˆé«˜é€Ÿï¼‰or "csv"ï¼ˆäº’æ›æ€§ï¼‰ |
| `data_source.npy_dir` | str | NPYå½¢å¼ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |
| `data_source.csv_dir` | str | CSVå½¢å¼ãƒ‡ãƒ¼ã‚¿ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª |

**å¾Œæ–¹äº’æ›æ€§:** `csv_dir`ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã¨è‡ªå‹•çš„ã«`data_source.type="csv"`ã¨ã—ã¦è§£é‡ˆã•ã‚Œã¾ã™ã€‚

```yaml
# æ—§å½¢å¼ï¼ˆã¾ã ã‚µãƒãƒ¼ãƒˆï¼‰
csv_dir: "dataset/10fold_csvs/"
```

#### NPYå½¢å¼ vs CSVå½¢å¼

| é …ç›® | NPYå½¢å¼ | CSVå½¢å¼ |
|------|---------|---------|
| é€Ÿåº¦ | âš¡ éå¸¸ã«é«˜é€Ÿ | ğŸ¢ ç”»åƒèª­ã¿è¾¼ã¿ã®ãŸã‚é…ã„ |
| ãƒ¡ãƒ¢ãƒª | åŠ¹ç‡çš„ï¼ˆmmapï¼‰ | ç”»åƒã”ã¨ã«èª­ã¿è¾¼ã¿ |
| å‰å‡¦ç† | å¿…è¦ | ä¸è¦ |
| æ¨å¥¨ç”¨é€” | å¤§è¦æ¨¡å®Ÿé¨“ | åˆæœŸé–‹ç™ºãƒ»ãƒ‡ãƒãƒƒã‚° |

## ğŸ”® predict/ - æ¨è«–è¨­å®š

### predict/single.yaml

```yaml
# æ¨è«–å¯¾è±¡ãƒ‡ãƒ¼ã‚¿
id: "test_001"
path: "/path/to/test_001.jpg"
class_id: 0  # æ­£è§£ãƒ©ãƒ™ãƒ«ï¼ˆè©•ä¾¡ç”¨ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

# ä½¿ç”¨ã™ã‚‹å­¦ç¿’æ¸ˆã¿é‡ã¿
weight_file: "outputs/runs/2024-01-01_12-00-00_train-single/Wout.npy"
```

### predict/batch.yaml

```yaml
# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿CSV
csv_path: "/path/to/test_data.csv"

# ä½¿ç”¨ã™ã‚‹å­¦ç¿’æ¸ˆã¿é‡ã¿
weight_file: "outputs/runs/2024-01-01_12-00-00_train-batch/Wout.npy"
```

## ğŸ“Š evaluate/ - è©•ä¾¡è¨­å®š

### evaluate/run.yaml

```yaml
# è©•ä¾¡å¯¾è±¡ã®å®Ÿè¡Œãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
run_dir: "outputs/runs/2024-01-01_12-00-00_predict-batch/"
```

### evaluate/summary.yaml

```yaml
# 10-foldçµæœãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
tenfold_dir: "outputs/10fold_results/"

# å¯è¦–åŒ–ã‚ªãƒ—ã‚·ãƒ§ãƒ³
plot_confusion_matrix: true
save_report: true
```

### evaluate/tenfold.yaml

```yaml
# å­¦ç¿’æ¸ˆã¿é‡ã¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
weights_dir: "outputs/10fold_results/"

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
data_source:
  type: "npy"
  npy_dir: "dataset/10fold_npy/"

# è©•ä¾¡ã‚ªãƒ—ã‚·ãƒ§ãƒ³
save_predictions: true
generate_plots: true
```

## ğŸ”¬ integ/ - çµ±åˆå®Ÿé¨“è¨­å®š

çµ±åˆå®Ÿé¨“ç”¨ã®ç‰¹æ®Šãªè¨­å®šã§ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ä½¿ç”¨ã—ã¾ã™ã€‚

```yaml
# çµ±åˆå®Ÿé¨“ã®è¨­å®šä¾‹
integration_test:
  train_config: "configs/train/tenfold.yaml"
  eval_config: "configs/evaluate/tenfold.yaml"
  output_dir: "outputs/integration_results/"
```

## ğŸ’¡ è¨­å®šã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. å†ç¾æ€§ã®ç¢ºä¿

```yaml
# å›ºå®šã‚·ãƒ¼ãƒ‰ã‚’ä½¿ç”¨
seeds: [2024]

# ãƒ¢ãƒ‡ãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
model:
  Nx: 200
  density: 0.5
  input_scale: 0.01
  rho: 0.9
```

### 2. ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¢ç´¢

```yaml
# 10-foldã§è‡ªå‹•ã‚°ãƒªãƒƒãƒ‰ã‚µãƒ¼ãƒ
hyperparams:
  Nx: [100, 200, 500, 1000]
  input_scale: [0.001, 0.005, 0.01, 0.05]
  rho: [0.7, 0.9, 1.1]
# â†’ 4 Ã— 4 Ã— 3 = 48é€šã‚Šã®çµ„ã¿åˆã‚ã›ã‚’è‡ªå‹•å®Ÿè¡Œ
```

### 3. NPYå½¢å¼ã®æ´»ç”¨

```yaml
# å‰å‡¦ç†ã‚’ä¸€åº¦å®Ÿè¡Œ
# $ python tools/dataprep/convert_10fold_to_npy.py

# è¨­å®šã§NPYå½¢å¼ã‚’æŒ‡å®š
data_source:
  type: "npy"
  npy_dir: "dataset/10fold_npy/"

# ä»¥é™ã®å®Ÿé¨“ã§é«˜é€ŸåŒ–
```

### 4. å®Ÿé¨“ã®æ•´ç†

```yaml
# å®Ÿé¨“åã‚’æ˜ç¢ºã«
experiment_name: "esn_Nx200_rho09_inputscale001"

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
project: "esn-classification-2024"
```

## ğŸ› ï¸ é«˜åº¦ãªè¨­å®š

### ç’°å¢ƒå¤‰æ•°ã®ä½¿ç”¨

```yaml
# ç’°å¢ƒå¤‰æ•°ã‚’å‚ç…§å¯èƒ½
data_source:
  npy_dir: "${DATA_ROOT}/10fold_npy/"

output_dir: "${OUTPUT_ROOT}/outputs/"
```

### è¨­å®šã®ç¶™æ‰¿ï¼ˆOmegaConfï¼‰

```yaml
# defaults.yaml
defaults:
  - base
  - train/tenfold

# ã‚«ã‚¹ã‚¿ãƒ å€¤ã§ä¸Šæ›¸ã
model:
  Nx: 500  # base.yamlã®å€¤ã‚’ä¸Šæ›¸ã
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ](./PACKAGE_STRUCTURE.md)
- [ãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ€ãƒ¼å®Ÿè£…](./DATALOADER_IMPLEMENTATION.md)
- [ã‚³ãƒãƒ³ãƒ‰ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](./commands.md)
